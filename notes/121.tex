%! Author = vladyslav
%! Date = 01.05.2022

% Preamble
\documentclass{article}

% Packages
\usepackage{amsmath}

\title{UniswapV2 - UniswapV3 arbitrage}
\author{Vladyslav Dalechyn}

\begin{document}

\maketitle


% Document
\section{Introduction}
    In order to run arbitrage, it's crucial to understand the underneath math in UniswapV2 and UniswapV3.\\

    UniswapV2 core is held in Pair, when UniswapV3 core is held in Pool.
    Pool is a tick-position-indexed state, and Pair is a regular state.

    We also know that the price of one asset can be defined as a price of the other asset.
    However, in case of UniswapV3, price is always defined as $token_1/token_0$.

\section{UniswapV2 Pair}
    Since all the data of a Pair is held in the fulfilled state which is available on contract,
    it's enough to read contract state to know the price, liquidity amounts, etc.

\section{UniswapV3 Pool}
    For the Pool situation is much different.\\
    We need to get the tick data, in which the liquidity data lies.

    When a swap is made in UniswapV3 Pool, the protocol looks if the current tick will be pushed
    up, or down, depending on the token ordering, which is a comparison of token contracts addresses and swap direction.

\section{Arbitrage}
    Arbitrage can be thought as rebalancing the pools in order for their price to meet equally.
    We don't know at the moment exaclty how much liquidity is locked in each tick.

\section{Formulas}
    $Price (\text{if both lte})= \frac{Q192}{ratioX192} = \frac{numerator}{denominator}$\\
    $Price (\text{if both not lte})= \frac{ratioX192}{Q192} = \frac{numerator}{denominator}$\\
    $ratioX192 (\text{if both lte})= \frac{Q192 * denominator}{numerator} $\\
    $ratioX192 (\text{if both not lte})= \frac{Q192 * numerator}{denominator} $\\

\end{document}